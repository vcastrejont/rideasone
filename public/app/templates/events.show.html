<div class="container box bg" id="events" >
  <header class="row">
    <div class="col-md-4">
      <h1>Events</h1><a ui-sref="events">Go back</a>
    </div>
    <div class="col-md-4 alerts">
      <p ng-repeat="alert in view.alerts" >{{alert.msg}}</p>
    </div>

    <div class="col-md-4 text-right" ng-show="view.user.id == view.event.organizer_id" >
      <a href="#" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit  </a>
      <a ng-click="view.deleteEvent()" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete</a>
    </div>
  </header>
  <main class="row show">
    <div class="row col-md-6">
      <div class="col-sm-6">
        <p><legend>Event name</legend>
          {{view.event.name}}
        </p>
        
        <p><legend>Date</legend>
          {{view.event.datetime | date:'shortDate'}} {{view.event.datetime | date:'shortTime'}}
        </p>
        
        <p><legend>Place</legend>
          {{view.event.place}}
        </p>
        <p><legend>Address</legend>
          {{view.event.address}}
        </p>
      </div>
      <div class="col-sm-6">
        <p><legend>Status</legend>
          <span class="label label-success" ng-show="view.event.signed.length">  You are signed </span>
        </p>
        
        <p><legend>Organizer</legend>
          {{view.event.organizer}}
        </p>
        <p><legend>Avaiable  seats </legend>
       {{view.event.avail}} 
        </p>
        <p><a href="" ng-click="view.shareEvent()">Share this</a></p>
      </div>
      
    </div>
    <div class="col-md-6">
      <legend>Location</legend>
      <div id="map"></div>
    </div>
    <div class="col-sm-12">
  
      <legend>Carpooling</legend>
      <div class="tabs">
         <div class="tab" ng-repeat="car in view.event.cars">
             <input type="radio" id="tab-car{{$index+1}}" name="carpooling-tabs"  ng-checked="$index == 0">
             <label for="tab-car{{$index+1}}">Car #{{$index+1}} 
               <span class="label label-primary" ng-if="car.driver_id==view.user.id">Driving</span>
               <span class="label label-success" ng-if="view.isSigned(car)">Joined</span>
             </label>
             <div class="content">
               <p>
                 <strong>Driver:</strong> <span ng-class="{'driving': car.driver_id == view.user.id }"> {{car.driver_name}}</span> 
               </p>
               <p>
                 <strong>Driver's comments:</strong>  {{car.comments}}
               </p>
               <p>
                 <strong>Passenger:</strong> 
                  <span ng-repeat="p in car.passengers" ng-class="{'sel': p.passenger_id == view.user.id }">
                    {{p.passenger_name}}<span ng-if="!$last">, </span>
                  </span>
               </p>
               <p>
                 <strong>Available seats:</strong> {{car.seats-(car.passengers.length)}} 
               </p>
               <p ng-if="view.isSigned(car) ">
                 <strong>Extra passangers:</strong>
                 
                 <select class="" name="" ng-model="view.extra">
                   <option value="{{$index+1}}" ng-repeat="i in view.getNumber(car.seats-(car.passanger.length)) track by $index">{{$index+1}}</option>  
                 </select>
                 <button ng-click="view.addExtra(car._id)" type="button" class="btn btn-primary btn-xsmall">Save</button>
               </p>
               <div ng-if=" car.driver_id == view.user.id" class="text-center"> 
                 <button class="btn btn-danger btn-xs" ng-click="view.deleteCar(car._id)">Remove my car</button>
               </div>
               
               <div ng-if="(car.driver_id !== view.user.id && car.passengers.length < car.seats && !view.isSigned(car) )" class="text-center"> 
                 <button class="btn btn-primary btn-xs btn-control" ng-click="view.joinCar(car._id)" >Join this ride</button>
               </div>
               <div class="text-center"  ng-if="view.isSigned(car)"> 
                 <button class="btn btn-danger btn-xs btn-control" ng-click="view.leaveCar(car._id)" >Leave this ride</button>
            
                
               </div>
             </div> 
         </div>
         <div class="tab">
           <input type="radio" id="tab-new" name="carpooling-tabs" >
           <label for="tab-new" class="add"> Add new car <span class="glyphicon glyphicon-plus"></span></label>
           <div class="content">
             <form class="form-horizontal" >
               <div class="form-group">
               <label for="inputEmail3" class="col-sm-4 control-label">How many available seats your car has?</label>
               <div class="col-sm-8">
                 <select class="form-control"  ng-model="view.seats" >
                   <option value="1">1 seat </option>
                   <option value="2">2 seats</option>
                   <option value="3">3 seats</option>
                   <option value="4">4 seats</option>
                   <option value="5">5 seats</option>
                   <option value="6">6 seats</option>
                 </select>
               </div>
             </div>
             <div class="form-group">
               <label for="new2" class="col-sm-4 control-label">Comments:</label>
               <div class="col-sm-8">
                 <textarea  rows="1" class="form-control" ng-model="view.comments" placeholder="Where do you live and when are you departing "></textarea>
                </div>
              </div>
               <p class="text-center"><button type="button" class="btn btn-success"  ng-click="view.addCar()">Add car</button></p>
            </form>
           </div>
         </div>
        </div>
      
    </div>  

        
    
         
  </main>
  

</div>

<!--TODO move to a different file and use ui.bootstrap.modal) -->
<div id="share-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Share this event</h4>
      </div>
      <div class="modal-body text-center">
        <div class="row">
          <p>
            {{view.event.place}}
          </p>
        </div>
        <div class="row">
          <a href="" ng-click="view.event.shortenedUrl">
            {{view.event.shortenedUrl}}
          </a>
        </div>
        <div class="row">
        <form id="share-event-form">
          <div class="row control-group">
            <div class="form-group col-xs-12 floating-label-form-group controls">
              <input type="text" class="form-control" placeholder="Type an email address or name" name="target_email" required>
            </div>
          </div>
          <div class="row control-group">
            <div class="form-group col-xs-12 floating-label-form-group controls">
              <textarea class="form-control" placeholder="Write a message (optional)" name="message"></textarea>
            </div>
          </div>
          </form>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger pull-left" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" ng-click="view.shareEventEmail()">Send</button>
      </div>

    </div>
  </div>
</div>